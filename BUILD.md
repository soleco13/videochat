
# Автоматическая сборка для продакшена

## Быстрая сборка

Просто выполните:

```bash
cd frontend
npm run build
```

Или используйте скрипт:

```bash
./build.sh
```

## Как это работает

1. **Vite собирает файлы напрямую в `staticfiles/`** - это директория, которую Django использует для статических файлов в продакшене
2. **Автоматическое версионирование** - при каждой сборке обновляется версия в `.static_version`, что обходит кэш браузера
3. **Django автоматически использует файлы из `staticfiles/`** - никаких дополнительных действий не требуется
4. **После сборки продакшен сразу использует новый билд** - просто перезапустите Django сервер, если он запущен

## Структура собранных файлов

- `staticfiles/js/vue-app.js` - основной JavaScript файл
- `staticfiles/styles/theme.css` - глобальные стили
- `staticfiles/styles/room.css` - стили комнаты
- `staticfiles/styles/chat.css` - стили чата
- `staticfiles/styles/lobby.css` - стили лобби

## Обход кэша браузера

Все статические файлы автоматически получают query-параметр `?v=<timestamp>`, который обновляется при каждой сборке. Это гарантирует, что браузер всегда загружает свежие файлы.

## Важно

- В режиме разработки (`DEBUG=True`) используются файлы с Vite dev server
- В продакшене (`DEBUG=False`) используются собранные файлы из `staticfiles/` с версионированием
- После сборки Django автоматически подхватывает новые файлы
- **Обязательно перезапустите Django сервер после сборки**, чтобы он загрузил новую версию из `.static_version`

## Устранение проблем

Если изменения не применяются на продакшене:

1. Убедитесь, что выполнили `npm run build` или `./build.sh`
2. Проверьте, что файлы собрались в `staticfiles/`
3. **Перезапустите Django сервер** - это важно для загрузки новой версии
4. Очистите кэш браузера (Ctrl+Shift+R или Cmd+Shift+R)
